---
title: "Project Proposal"
author:"Pooja Kabber, Dingkun Yang, Echo Chen, Andrew Kroening"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
packages <- (c("tidyverse","ggcorrplot" ,"stargazer", "ggplot2","corrplot","leaps","car","Metrics","reshape2","ggpubr","moments"))
installed_packages <- packages %in% rownames(installed.packages())
if (any(installed_packages == FALSE)) {
  install.packages(packages[!installed_packages])
}
invisible(lapply(packages, library, character.only = TRUE))
```

# Data Overview

*Characteristics of the dataset, sample size, number of variables. Include questions here.*

The publicly available dataset provides data for 193 countries spanning from year 2000 to year 2015 and is structured in **2938 rows** (data points) which are characterized into a total of **22 columns** (features). The features can be categorized into two groups: - Health factors which are originally provided by the Global Health Observatory (GHO) data repository under the World Health Organization (WHO) - Economic factors which have been collected by the United Nation (UN) website.

| Variable                        |  Type   |                                                                                            Description |
|---------------------------------|:-------:|-------------------------------------------------------------------------------------------------------:|
| Country                         | factor  |                                                                                           Country name |
| Year                            | numeric |                                                                                       Year of the data |
| Status                          | factor  |                                                              Country status of developed or developing |
| Life_Expectancy                 | numeric |                                                                                 Life expectancy in age |
| Adult_Mortality                 | numeric | Adult Mortality Rates of both sexes (probability of dying between 15 and 60 years per 1000 population) |
| infant.deaths                   | numeric |                                                            Number of Infant Deaths per 1000 population |
| Alcohol                         | numeric |                             Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol) |
| percentage.expenditure          | numeric |                          Expenditure on health as a percentage of Gross Domestic Product per capita(%) |
| Hepatitis.B                     | numeric |                                         Hepatitis B (HepB) immunization coverage among 1-year-olds (%) |
| Measles                         | numeric |                                                           number of reported cases per 1000 population |
| BMI                             | numeric |                                                           Average Body Mass Index of entire population |
| under.five.deaths               | numeric |                                                        Number of under-five deaths per 1000 population |
| Polio                           | numeric |                                               Polio (Pol3) immunization coverage among 1-year-olds (%) |
| Total.expenditure               | numeric |           General government expenditure on health as a percentage of total government expenditure (%) |
| Diphtheria                      | numeric |        Diphtheria tetanus toxoid and pertussis (DTP3) immunization coverage among 1-year-olds (%)room) |
| HIV.AIDS                        | numeric |                                                      Deaths per 1 000 live births HIV/AIDS (0-4 years) |
| GDP                             | numeric |                                                             Gross Domestic Product per capita (in USD) |
| Population                      | numeric |                                                                              Population of the country |
| thinness..1.19.years            | numeric |                            Prevalence of thinness among children and adolescents for Age 10 to 19 (% ) |
| thinness.5.9.years              | numeric |                                                Prevalence of thinness among children for Age 5 to 9(%) |
| Income.composition.of.resources | numeric |        Human Development Index in terms of income composition of resources (index ranging from 0 to 1) |
| Schooling                       | numeric |                                                                    Number of years of Schooling(years) |

```{r Initial EDA}
life <- read.csv(file = '/Users/dp/Downloads/IDS 702/final /orange-modeling-project/_00_Datasets/Life_Expectancy_Data.csv')
life14 <- life[which(life$Year==2014),] # select year 2014
life14$Status <-factor(life14$Status)
life14 <- subset(life14,select = -c(Country,Year,Adult.Mortality,infant.deaths,Alcohol,BMI,under.five.deaths,Total.expenditure,thinness..1.19.years,thinness.5.9.years))# select variables
stargazer(life14,header=FALSE, type="text", 
          no.space = TRUE,
          report = ('vcsp*'), single.row = TRUE,
          column.sep.width = "0.2pt",
          font.size = "small",
          title="Regression Summary")
```

Questions1: Main variables affecting of life expectancy in the year 2014

Questions2: Can we use predictors to accurately predict country's status(developed or developing)

```{r visualize data}
ggplot(data, aes(x=Life.expectancy)) + 
    geom_density(alpha=.3, fill="red", color="red", size=1.5)+
    geom_vline(aes(xintercept=mean(Life.expectancy)), size=1)+
    ggtitle("Distribution density of Life.expectancy") +
    theme(text = element_text(size = 18))
    
sprintf("Skewness: [%s]", toString(skewness(data$Life.expectancy, na.rm = TRUE)))
```

# Primary Relationship of Interest

*Present descriptive statistics and exploratory plots in whichever format you think is best (tables, figures) for your primary relationship of interest (dependent variable and primary independent variable, if applicable). Describe your findings.*

```{r}

ggplot(data ,aes(x= Status,y=Life.expectancy, fill= Status)) + 
        geom_boxplot() +
        ggtitle("Life expectancy per country Status")+
        theme(text = element_text(size = 18))+
        scale_fill_brewer(palette="Set1")
```

# Other Characteristics

*Briefly describe other variables in the data. If there are many, do not list them all. Rather, describe the types of variables that are present (e.g., "demographic information").*

```{r}
#life <-subset(life,select = -c(Country, Year))
corr <- round(cor(subset(life14, select =-c(Status))), 5)
ggcorrplot(corr,type = "upper", lab = TRUE, outline.color = "black", lab_size = 4, legend.title = "Correlation")+
ggtitle("Correlation Matrix")
```

# Potential Challenges

*Describe aspects of the data that may present challenges in the modeling stage. For example, might certain categorical variables need to be collapsed? Is there a lot of missingness? Could the size of the dataset present model selection challenges?*

```{r}
data <- life14
data <- subset(data, select = -c(Country, Year))
```

```{r visualize missing data,fig.width=16,fig.height=4 }
missing.rows = dim(data)[1] -  dim(na.omit(data))[1]
sprintf("Dataset size: [%s]", toString(dim(data)))
sprintf("Missing rows: %s (%s%%)", missing.rows, round((missing.rows*100)/dim(data)[1], 2))

missings_df <- data.frame(type=c("missing", "non-missing") ,count = c(missing.rows,  dim(na.omit(data))[1]))

ggplot(missings_df, aes(fill=type, y="", x=count)) + 
    geom_bar(position="stack", stat="identity")+
    ggtitle("Missing vs Non-missing row counts") +
    xlab("Missing count") + ylab("") +
    theme(text = element_text(size = 18))+
    scale_fill_brewer(palette="Set1")
```

```{r visualize missing data, echo=FALSE,fig.width=10,fig.height=4}
missing_counts <- data.frame(feature = factor(names(data)),
                    counts=sapply(data, function(x) sum(is.na(x))))

ggplot(missing_counts,
       aes(x=reorder(feature, -counts), y=counts, fill=counts)) +
                                  geom_bar(stat="identity") +
                                  ggtitle("Missing counts in each feature") +
                                  xlab("Feature") + ylab("Missing count") +
                                  theme(axis.text.x=element_text(angle=20, hjust=1))+
                                  theme(text = element_text(size = 18))+
                                  scale_fill_continuous(trans = 'reverse')
```

```{r}
par(mfrow=c(2,4))
boxplot(data$Life.expectancy,
        ylab = "Life Expectancy",
        main = "Boxplot of Life Expectancy",
        col= "#FF6666",
        outcol="#FF6666")
boxplot(data$Hepatitis.B,
        ylab = "Hepatitis B",
        main = "Boxplot of Hepatitis B",
        col= "#FF6666",
        outcol="#FF6666")
boxplot(data$Polio,
        ylab = "Polio",
        main = "Boxplot of Polio",
        col= "#FF6666",
        outcol="#FF6666")
boxplot(data$Diphtheria,
        ylab = "Diphteria",
        main = "Boxplot of Diphteria",
        col= "#FF6666",
        outcol="#FF6666")
boxplot(data$GDP,
        ylab = "GDP",
        main = "Boxplot of GDP",
        col= "#FF6666",
        outcol="#FF6666")
boxplot(data$Population,
        ylab = "Population",
        main = "Boxplot of Population",
        col= "#FF6666",
        outcol="#FF6666")
boxplot(data$Income.composition.of.resources,
        ylab = "Income Composition",
        main = "Boxplot of Income Composition",
        col= "#008080",
        outcol="#008080")
boxplot(data$Schooling,
        ylab = "Schooling",
        main = "Boxplot of Schooling",
        col= "#FF6666",
        outcol="#FF6666")
```

-   Checking outliers in each variable that contains missings using boxplots

-   The variables with **high outliers** will apply imputation with **median**

-   The variables with **low outliers** will apply imputation with **mean**.
